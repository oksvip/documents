<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>Mongodb - Centos软件安装</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../../css/highlight.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Mongodb";
    var mkdocs_page_input_path = "install/mongodb.md";
    var mkdocs_page_url = "/install/mongodb/";
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js"></script>
  <script src="../../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../../js/highlight.pack.js"></script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> Centos软件安装</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="../..">简介</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">笔记</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../study/git/">Git</a>
                </li>
                <li class="">
                    
    <a class="" href="../../study/javascript/">JavaScript</a>
                </li>
                <li class="">
                    
    <a class="" href="../../study/mysql/">Mysql</a>
                </li>
                <li class="">
                    
    <a class="" href="../../study/vim/">Vim</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">知识</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../study/ask-wisdom/">提问的智慧</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">软件</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../ubuntu/">Ubuntu-php-version</a>
                </li>
                <li class="">
                    
    <a class="" href="../ubuntu-mutiply-php-version/">ubuntu-mutiply-php-version</a>
                </li>
                <li class="">
                    
    <a class="" href="../vim/">Vim</a>
                </li>
                <li class="">
                    
    <a class="" href="../vsftpd/">Vsftpd</a>
                </li>
                <li class="">
                    
    <a class="" href="../httpd/">Apache</a>
                </li>
                <li class="">
                    
    <a class="" href="../mysql/">Mysql</a>
                </li>
                <li class="">
                    
    <a class="" href="../php/">Php</a>
                </li>
                <li class="">
                    
    <a class="" href="../git/">Git</a>
                </li>
                <li class="">
                    
    <a class="" href="../redis/">Redis</a>
                </li>
                <li class="">
                    
    <a class="" href="../memcached/">Memcached</a>
                </li>
                <li class=" current">
                    
    <a class="current" href="./">Mongodb</a>
    <ul class="subnav">
            
    <li class="toctree-l3"><a href="#mongodb">创建mongodb用户组和用户</a></li>
    

    <li class="toctree-l3"><a href="#mongodb_1">下载mongodb源码包</a></li>
    

    <li class="toctree-l3"><a href="#mongodb_2">创建mongodb文件目录</a></li>
    

    <li class="toctree-l3"><a href="#mongodb_3">将文件复制到mongodb/目录</a></li>
    

    <li class="toctree-l3"><a href="#mongodbmongodbconf">创建mongodb配置文件mongodb.conf</a></li>
    

    <li class="toctree-l3"><a href="#_1">添加下面内容，保存退出</a></li>
    

    <li class="toctree-l3"><a href="#mongodb_4">修改mongodb目录权限</a></li>
    

    <li class="toctree-l3"><a href="#mongodbprofile">将mongodb命令加入环境变量，修改profile文件</a></li>
    

    <li class="toctree-l3"><a href="#mongodbinitdmongod">将mongodb服务脚本加入到init.d/目录，创建mongod文件</a></li>
    

    <li class="toctree-l3"><a href="#_2">加入下面内容，保存退出</a></li>
    

    <li class="toctree-l3"><a href="#mongod">为mongod添加可执行权限</a></li>
    

    <li class="toctree-l3"><a href="#mongodb_5">将mongodb加入系统服务</a></li>
    

    <li class="toctree-l3"><a href="#_3">修改服务的默认启动等级</a></li>
    

    <li class="toctree-l3"><a href="#mongodb_6">启动mongodb</a></li>
    

    <li class="toctree-l3"><a href="#php7mongodb">二、PHP7安装MongoDB拓展</a></li>
    
        <ul>
        
            <li><a class="toctree-l4" href="#php7-mongodb">下载php7 mongodb拓展包</a></li>
        
            <li><a class="toctree-l4" href="#_4">解压拓展包</a></li>
        
            <li><a class="toctree-l4" href="#mongodb_7">进入mongodb拓展目录，编译安装拓展</a></li>
        
            <li><a class="toctree-l4" href="#phpini">修改php.ini文件</a></li>
        
            <li><a class="toctree-l4" href="#mongodbso">添加mongodb.so扩展配置，保存退出</a></li>
        
            <li><a class="toctree-l4" href="#apachephp-fpm">重启Apache或php-fpm</a></li>
        
            <li><a class="toctree-l4" href="#_5">测试是否安装成功</a></li>
        
        </ul>
    

    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../composer/">Composer</a>
                </li>
                <li class="">
                    
    <a class="" href="../mkdocs/">Mkdocs</a>
                </li>
                <li class="">
                    
    <a class="" href="../node/">Node</a>
                </li>
                <li class="">
                    
    <a class="" href="../all/">All</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">学习</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../study/laravel5-thinkphp5/">Laravel&ThinkPHP</a>
                </li>
                <li class="">
                    
    <a class="" href="../../study/laravel-email/">Laravel发送email</a>
                </li>
                <li class="">
                    
    <a class="" href="../../study/project-readme-example/">ReadMe-Example</a>
                </li>
    </ul>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">Centos软件安装</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>软件 &raquo;</li>
        
      
    
    <li>Mongodb</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h5 id="mongodb">创建mongodb用户组和用户</h5>
<pre><code class="shell">$ groupadd mongodb
$ useradd -r -g mongodb -s /sbin/nologin -M mongodb
</code></pre>

<h5 id="mongodb_1">下载mongodb源码包</h5>
<pre><code class="tex">下载页面：https://www.mongodb.com/download-center?jmp=nav
这里用的是 mongodb-linux-x86_64-rhel62-3.2.10.tgz
下载地址：https://fastdl.mongodb.org/linux/mongodb-linux-x86_64-rhel62-3.2.10.tgz
</code></pre>

<h5 id="mongodb_2">创建mongodb文件目录</h5>
<pre><code class="shell">$ mkdir -p /usr/local/mongodb/data
$ mkdir -p /usr/local/mongodb/conf
$ mkdir -p /usr/local/mongodb/run
$ mkdir -p /usr/local/mongodb/log
</code></pre>

<h5 id="mongodb_3">将文件复制到mongodb/目录</h5>
<pre><code class="shell">$ mv mongodb-linux-i686-2.4.9 /usr/local/mongodb
</code></pre>

<h5 id="mongodbmongodbconf">创建mongodb配置文件mongodb.conf</h5>
<pre><code class="shell">$ cd /usr/local/mongodb/conf
$ vim mongodb.conf
</code></pre>

<h5 id="_1">添加下面内容，保存退出</h5>
<pre><code class="tex">dbpath=/usr/local/mongodb/data #数据目录存在位置
logpath=/usr/local/mongodb/log/mongodb.log #日志文件存放目录
logappend=true #写日志的模式:设置为true为追加
fork=true  #以守护程序的方式启用，即在后台运行
verbose=true
vvvv=true #启动verbose冗长信息，它的级别有 vv~vvvvv，v越多级别越高，在日志文件中记录的信息越详细
maxConns=20000 #默认值：取决于系统（即的ulimit和文件描述符）限制。MongoDB中不会限制其自身的连接
pidfilepath=/usr/local/mongodb/run/mongodb.pid
directoryperdb=true #数据目录存储模式,如果直接修改原来的数据会不见了
profile=0 #数据库分析等级设置,0 关 2 开。包括所有操作。 1 开。仅包括慢操作
slowms=200 #记录profile分析的慢查询的时间，默认是100毫秒
quiet=true
syncdelay=60 #刷写数据到日志的频率，通过fsync操作数据。默认60秒
#port=27017  #端口
#bind_ip = 10.1.146.163 #IP
#auth=true  #开始认证
#nohttpinterface=false #28017 端口开启的服务。默认false，支持
#notablescan=false#不禁止表扫描操作
#cpu=true #设置为true会强制mongodb每4s报告cpu利用率和io等待，把日志信息写到标准输出或日志文件
</code></pre>

<h5 id="mongodb_4">修改mongodb目录权限</h5>
<pre><code class="shell">$ chown -R mongodb:mongodb /usr/local/mongodb
$ chown -R mongodb:mongodb usr/local/mongodb/run
$ chown -R mongodb:mongodb usr/local/mongodb/log
</code></pre>

<h5 id="mongodbprofile">将mongodb命令加入环境变量，修改profile文件</h5>
<pre><code class="shell">$ echo &quot;export PATH=$PATH:/usr/local/mongodb/bin&quot; &gt;&gt; /etc/profile
$ source /etc/profile
</code></pre>

<h5 id="mongodbinitdmongod">将mongodb服务脚本加入到init.d/目录，创建mongod文件</h5>
<pre><code class="shell">$ vim /etc/init.d/mongodb
</code></pre>

<h5 id="_2">加入下面内容，保存退出</h5>
<pre><code class="c">#!/bin/sh  
# chkconfig: 2345 93 18
# description:MongoDB  

#默认参数设置
#mongodb 家目录
MONGODB_HOME=/usr/local/mongodb

#mongodb 启动命令
MONGODB_BIN=$MONGODB_HOME/bin/mongod

#mongodb 配置文件
MONGODB_CONF=$MONGODB_HOME/conf/mongodb.conf

MONGODB_PID=$MONGODB_HOME/run/mongodb.pid

#最大文件打开数量限制
SYSTEM_MAXFD=65535

#mongodb 名字  
MONGODB_NAME=&quot;mongodb&quot;
. /etc/rc.d/init.d/functions

if [ ! -f $MONGODB_BIN ]
then
    echo &quot;$MONGODB_NAME startup: $MONGODB_BIN not exists! &quot;  
    exit
fi

start(){
    ulimit -HSn $SYSTEM_MAXFD
    $MONGODB_BIN --config=&quot;$MONGODB_CONF&quot;  --journal
    ret=$?
    if [ $ret -eq 0 ]; then
        action $&quot;Starting $MONGODB_NAME: &quot; /bin/true
    else
        action $&quot;Starting $MONGODB_NAME: &quot; /bin/false
    fi
}

stop(){
    PID=$(ps aux |grep &quot;$MONGODB_NAME&quot; |grep &quot;$MONGODB_CONF&quot; |grep -v grep |wc -l) 
    if [[ $PID -eq 0  ]];then
        action $&quot;Stopping $MONGODB_NAME: &quot; /bin/false
        exit
    fi
    kill -HUP `cat $MONGODB_PID`
    ret=$?
    if [ $ret -eq 0 ]; then
        action $&quot;Stopping $MONGODB_NAME: &quot; /bin/true
        rm -f $MONGODB_PID
    else   
        action $&quot;Stopping $MONGODB_NAME: &quot; /bin/false
    fi
}

restart(){
    stop
    sleep 2
    start
}

case &quot;$1&quot; in
    start)
        start
        ;;
    stop)
        stop
        ;;
    status)
    status $prog
        ;;
    restart)
        restart
        ;;
    *)
        echo $&quot;Usage: $0 {start|stop|status|restart}&quot;
esac
</code></pre>

<h5 id="mongod">为mongod添加可执行权限</h5>
<pre><code class="shell">$ chmod +x /etc/init.d/mongodb
</code></pre>

<h5 id="mongodb_5">将mongodb加入系统服务</h5>
<pre><code class="shell">$ chkconfig --add mongodb
</code></pre>

<h5 id="_3">修改服务的默认启动等级</h5>
<pre><code class="shell">$ chkconfig mongodb on
</code></pre>

<h5 id="mongodb_6">启动mongodb</h5>
<pre><code class="shell">$ service mongodb start
</code></pre>

<h3 id="php7mongodb">二、PHP7安装MongoDB拓展</h3>
<h5 id="php7-mongodb">下载php7 mongodb拓展包</h5>
<pre><code class="tex">下载页面：http://pecl.php.net/package/mongodb
这里用的是 mongodb-1.1.9.tgz
下载地址：http://pecl.php.net/get/mongodb-1.1.9.tgz
</code></pre>

<h5 id="_4">解压拓展包</h5>
<pre><code class="shell">$ cd /usr/local/soft
$ tar -zxf mongodb-1.1.9.tgz
</code></pre>

<h5 id="mongodb_7">进入mongodb拓展目录，编译安装拓展</h5>
<pre><code class="shell">$ cd mongodb-1.1.9/
$ /usr/local/php/bin/phpize
$ ./configure --with-php-config=/usr/local/php/bin/php-config
$ make &amp;&amp; make install
</code></pre>

<h5 id="phpini">修改php.ini文件</h5>
<pre><code class="shell">$ vim /usr/local/php/php.ini
</code></pre>

<h5 id="mongodbso">添加mongodb.so扩展配置，保存退出</h5>
<pre><code class="shell">$ extension=mongodb.so
</code></pre>

<h5 id="apachephp-fpm">重启Apache或php-fpm</h5>
<pre><code class="shell">$ service httpd restart
</code></pre>

<h5 id="_5">测试是否安装成功</h5>
<pre><code class="php">&lt;?php
$manager = new MongoDB\Driver\Manager(&quot;mongodb://127.0.0.1:27017&quot;);
$bulk = new MongoDB\Driver\BulkWrite;
$bulk-&gt;insert(['x' =&gt; 1, 'class'=&gt;'toefl', 'num' =&gt; '18']);
$bulk-&gt;insert(['x' =&gt; 2, 'class'=&gt;'ielts', 'num' =&gt; '26']);
$bulk-&gt;insert(['x' =&gt; 3, 'class'=&gt;'sat', 'num' =&gt; '35']);
$manager-&gt;executeBulkWrite('test.log', $bulk);
$filter = ['x' =&gt; ['$gt' =&gt; 1]];
$options = [
    'projection' =&gt; ['_id' =&gt; 0],
    'sort' =&gt; ['x' =&gt; -1],
];
$query = new MongoDB\Driver\Query($filter, $options);
$cursor = $manager-&gt;executeQuery('test.log', $query);
foreach ($cursor as $document) {
    print_r($document);
}
</code></pre>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../composer/" class="btn btn-neutral float-right" title="Composer">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../memcached/" class="btn btn-neutral" title="Memcached"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>
    
  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../memcached/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../composer/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script src="../../js/theme.js"></script>

</body>
</html>
